<view class="container">
  <view class="header">
    <view class="page-title">
      <text>ğŸ“Š æˆé•¿æŠ¥å‘Š</text>
    </view>
    <view class="date-display">{{date}}</view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹© -->
  <scroll-view scroll-x="true" class="date-scroll" enable-flex>
    <view class="date-list">
      <block wx:for="{{days}}" wx:key="*this">
        <view class="date-chip {{item === date ? 'active' : ''}}" bindtap="changeDate" data-date="{{item}}">
          <text class="chip-text">{{item}}</text>
        </view>
      </block>
    </view>
  </scroll-view>

  <!-- æ ¸å¿ƒæ•°æ®çœ‹æ¿ -->
  <view class="dashboard-grid">
    <view class="glass-card stat-card primary">
      <view class="stat-icon">â±</view>
      <view class="stat-val">{{totals.minutes}}</view>
      <view class="stat-label">ä¸“æ³¨(åˆ†)</view>
    </view>
    <view class="glass-card stat-card">
      <view class="stat-icon">âœ…</view>
      <view class="stat-val">{{totals.completion}}</view>
      <view class="stat-label">å®Œæˆ/æ€»æ•°</view>
    </view>
    <view class="glass-card stat-card">
      <view class="stat-icon">âš¡ï¸</view>
      <view class="stat-val">{{totals.interrupts}}</view>
      <view class="stat-label">ä¸­æ–­</view>
    </view>
  </view>

  <!-- ä»»åŠ¡æ˜ç»† -->
  <view class="section-header">
    <text class="section-title">ä»Šæ—¥ä»»åŠ¡æ˜ç»†</text>
  </view>

  <block wx:if="{{detailedTasks.length > 0}}">
    <view class="detail-list">
      <view class="glass-card detail-card" wx:for="{{detailedTasks}}" wx:key="id">
        <view class="detail-status {{item.completed ? 'done' : ''}}">
          {{item.completed ? 'âœ“' : 'â—‹'}}
        </view>
        <view class="detail-content">
          <view class="detail-name {{item.completed ? 'text-done' : ''}}">{{item.name}}</view>
          <view class="detail-meta">
            <text>å®é™…ä¸“æ³¨ {{item.actualMinutes}} åˆ†é’Ÿ</text>
            <text class="divider">|</text>
            <text>ä¸­æ–­ {{item.interruptions}} æ¬¡</text>
          </view>
        </view>
        <view class="detail-badge" wx:if="{{item.actualMinutes > item.expectedMinutes}}">è¶…æ—¶</view>
        <view class="detail-badge success" wx:elif="{{item.completed}}">å®Œç¾</view>
      </view>
    </view>
  </block>
  <block wx:else>
    <view class="empty-report">
      <view class="empty-icon">ğŸ“­</view>
      <view class="empty-text">è¯¥æ—¥æ— ä»»åŠ¡è®°å½•</view>
    </view>
  </block>

  <!-- å‘¨æŠ¥æ¦‚è§ˆ -->
  <block wx:if="{{week}}">
    <view class="glass-card week-summary">
      <view class="week-header">
        <text class="week-title">æœ¬å‘¨æ¦‚è§ˆ</text>
        <text class="week-range">{{week.startDate}} è‡³ {{week.endDate}}</text>
      </view>
      <view class="week-stats">
        <view class="week-stat-item">
          <view class="val">{{week.averageFocusMinutes}}</view>
          <view class="label">å¹³å‡æ—¶é•¿</view>
        </view>
        <view class="week-divider"></view>
        <view class="week-stat-item">
          <view class="val">{{week.averageInterruptions}}</view>
          <view class="label">å¹³å‡ä¸­æ–­</view>
        </view>
      </view>

      <view class="ai-comment-section">
        <view class="ai-header" bindtap="getAiComment">
          <text>ğŸ¤– AI è€å¸ˆç‚¹è¯„</text>
          <text class="ai-btn-text" wx:if="{{!aiComment && !loadingAi}}">ç‚¹å‡»ç”Ÿæˆ</text>
        </view>
        <view class="ai-content" wx:if="{{loadingAi}}">æ­£åœ¨æ€è€ƒä¸­...</view>
        <view class="ai-content" wx:elif="{{aiComment}}">{{aiComment}}</view>
      </view>
    </view>
  </block>
</view>
