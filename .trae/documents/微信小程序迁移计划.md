# 微信小程序迁移与适配计划

为了满足“完整迁移并适配为微信小程序版本”的要求，我们将创建一个独立的 `miniprogram` 目录，并按照微信小程序的规范重写前端逻辑、模拟后端适配（因本项目为无后端架构）及配置工程化结构。

## 1. 工程化改造与目录结构
- **创建根目录**：`/miniprogram`，作为小程序项目的根目录。
- **配置文件**：
  - `project.config.json`：小程序项目配置文件（appid、编译配置）。
  - `app.json`：全局配置（页面路由、窗口表现、Tabbar）。
  - `app.js`：全局入口，处理生命周期（如 `onLaunch` 进行登录模拟）。
  - `app.wxss`：全局样式（复用原有的极简黑白风格）。

## 2. 前端改造 (WXML/WXSS/JS)
我们将把 React Native 的三个核心页面重写为小程序页面：
- **工具库 (`utils/storage.js`)**：
  - 将 `src/storage.ts` 改写为使用 `wx.getStorageSync` / `wx.setStorageSync`。
  - 保持原有的数据结构（`DayRecord`, `TaskItem` 等）一致，以便逻辑复用。

- **页面一：作业设定 (`pages/setup/index`)**
  - **WXML**：使用 `<view>`, `<input>`, `<button>` 重写 UI。
  - **交互**：实现列表渲染 `wx:for`。注意：小程序原生拖拽排序较复杂，MVP阶段将使用“上移/下移”按钮替代 RN 的 `DraggableFlatList`，或使用简化的 `movable-area`（如果时间允许，优先保证核心功能可用性，采用按钮排序）。

- **页面二：专注执行 (`pages/focus/index`)**
  - **WXML**：展示当前作业、计时器、状态按钮。
  - **逻辑**：
    - 使用 `setInterval` 进行计时。
    - **核心适配**：使用 `wx.onAppHide` 和 `wx.onAppShow` (在 Page 生命周期中对应 `onHide`/`onShow`) 来替代 RN 的 `AppState` 监听，记录中断次数。
    - 保持屏幕常亮：`wx.setKeepScreenOn`。

- **页面三：家长报告 (`pages/report/index`)**
  - **WXML**：展示日报数据、周汇总。
  - **逻辑**：读取本地存储，计算统计数据。
  - **交互**：使用 `<scroll-view>` 实现日期切换 Chip 列表。

## 3. 后端适配 (模拟与预留)
由于当前是无后端架构（Local-only），我们将实现“符合规范的接口层”，但底层指向本地或 Mock：
- **登录授权**：在 `app.js` 中调用 `wx.login()` 获取 code，模拟“静默登录”流程。
- **网络请求封装**：创建 `utils/request.js`，封装 `wx.request`。虽然 MVP 用不到真实服务器，但这符合“工程化改造”要求，为未来接入后端做准备。
- **支付占位**：提供一个 `utils/pay.js` 占位函数，说明 MVP 阶段暂无支付功能。

## 4. 测试与交付
- **验证**：确保三个模块（设定-专注-报告）流程跑通。
- **真机调试**：提供“真机预览”二维码（需用户有开发者账号或使用测试号）。

---

**执行顺序**：
1.  初始化目录结构与核心配置 (`app.json`, `project.config.json`)。
2.  移植核心逻辑层 (`utils/storage.js`)。
3.  开发 `Setup` 页面（UI + 逻辑）。
4.  开发 `Focus` 页面（UI + 计时 + 中断逻辑）。
5.  开发 `Report` 页面（UI + 统计）。
6.  完善 `app.js` (登录/生命周期)。
