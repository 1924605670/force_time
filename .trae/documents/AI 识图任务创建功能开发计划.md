# 任务创建功能升级：集成图片识别与 GLM-4 智能分析

我们将为“作业设定”页面增加**AI 识图创建任务**功能。鉴于当前是纯小程序（Local-only）架构，我们将直接在小程序端调用硅基流动 (SiliconFlow) API（需注意这在生产环境通常不安全，建议后续迁移至云函数，MVP 阶段可直连）。

## 1. 前端改造 (Setup 页面)
- **UI 增加**：在输入框旁边增加一个“📸 拍照/相册”按钮。
- **图片预览**：选择图片后，展示缩略图，并显示“正在分析...”的 Loading 状态。
- **粘贴支持**：微信小程序暂不支持 Web 端的 `onPaste` 事件，主要通过“相册/拍照”或“聊天文件”导入。我们将使用 `wx.chooseMedia`。

## 2. 核心逻辑：图片分析与 API 调用
- **图片转 Base64**：小程序文件系统读取图片文件并转换为 Base64 编码。
- **调用硅基流动 API**：
  - **模型**：`glm-4v-9b` (或 User 指定的 GLM-4.7，需确认 API 支持的 Vision 模型名称，通常 Vision 模型为 `glm-4v`)。
  - **Prompt**：设计高效 Prompt，要求模型提取“任务名称”、“预计时长（分钟）”。
  - **接口封装**：创建 `utils/ai.js` 封装 API 请求。

## 3. 结果处理与交互
- **自动填单**：解析 API 返回的 JSON，自动填充到页面上的“作业名称”和“预计时长”输入框中。
- **用户确认**：用户可以修改自动填充的内容，然后点击“添加”。

## 4. 安全与限制 (MVP)
- **API Key**：MVP 阶段需要将 Key 硬编码或存储在本地（**风险提示**：发布版必须走后端）。
- **图片压缩**：使用 `wx.compressImage` 确保图片不超过 5MB 且加快上传速度。

---

**执行计划**：
1.  创建 `utils/ai.js`，实现 SiliconFlow API 调用逻辑 (ChatCompletions + Vision)。
2.  修改 `pages/setup/index.wxml`，添加图片选择按钮和 Loading UI。
3.  修改 `pages/setup/index.js`，实现图片选择、压缩、转 Base64 及调用 AI 逻辑。
4.  测试识别流程。

*(注意：请确认您已拥有 SiliconFlow 的 API Key。若无，我将提供代码占位符。)*
