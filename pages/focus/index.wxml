<view class="container focus-container">
  <!-- ç»“æŸçŠ¶æ€ -->
  <block wx:if="{{!currentTask}}">
    <view class="finish-state">
      <view class="finish-icon">ğŸ‰</view>
      <view class="finish-title">å¤ªæ£’äº†ï¼</view>
      <view class="finish-desc">ä»Šæ—¥ä½œä¸šæŒ‘æˆ˜å·²å…¨éƒ¨å®Œæˆ</view>
      <button class="btn btn-primary btn-lg mt-40" bindtap="goToReport">æŸ¥çœ‹ä»Šæ—¥æˆ˜ç»©</button>
    </view>
  </block>

  <!-- ä¸“æ³¨çŠ¶æ€ -->
  <block wx:else>
    <view class="glass-card task-info-card">
      <view class="task-label">å½“å‰ä»»åŠ¡ ({{currentIndex + 1}}/{{totalCount}})</view>
      <view class="task-title">{{currentTask.name}}</view>
      <view class="task-target">ç›®æ ‡ï¼š{{currentTask.expectedMinutes}} åˆ†é’Ÿ</view>
    </view>

    <view class="timer-section">
      <view class="timer-ring">
        <canvas type="2d" id="progressCanvas" class="progress-canvas"></canvas>
        <view class="timer-content">
          <view class="timer-val">{{focusMinutes}}</view>
          <view class="timer-unit">åˆ†</view>
        </view>
      </view>
    </view>

    <!-- çŠ¶æ€æŒ‡æ ‡ -->
    <view class="metrics-row">
      <view class="glass-card metric-item">
        <text class="metric-icon">âš¡ï¸</text>
        <view class="metric-text">
          <text class="val">{{interruptions}}</text>
          <text class="label">ä¸­æ–­</text>
        </view>
      </view>
      <view class="glass-card metric-item">
        <text class="metric-icon">ğŸ“Š</text>
        <view class="metric-text">
          <text class="val">{{completedCount}}/{{totalCount}}</text>
          <text class="label">è¿›åº¦</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œåŒº -->
    <view class="action-area">
      <button class="btn btn-main {{isFocusing ? 'pause' : 'start'}}" bindtap="toggleFocus">
        <text class="btn-icon">{{isFocusing ? 'â¸' : 'â–¶'}}</text>
        <text>{{isFocusing ? 'æš‚åœè®¡æ—¶' : 'å¼€å§‹ä¸“æ³¨'}}</text>
      </button>

      <view class="sub-actions">
        <view class="sub-btn finish glass-card" bindtap="completeCurrent">
          <text>âœ… å®Œæˆ</text>
        </view>
        <view class="sub-btn skip glass-card" bindtap="nextTask">
          <text>â­ è·³è¿‡</text>
        </view>
      </view>
      
      <view class="text-btn" bindtap="goToReport">ç»“æŸå¹¶æŸ¥çœ‹æŠ¥å‘Š</view>
    </view>
  </block>
</view>
